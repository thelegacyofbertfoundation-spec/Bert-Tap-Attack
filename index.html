<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Bert Tap Attack</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #fff; font-family: 'Arial', sans-serif; text-align: center; 
            height: 100vh; display: flex; flex-direction: column; 
            justify-content: space-between; overflow: hidden; touch-action: manipulation;
        }
        #header { padding-top: 20px; }
        #coin-icon { width: 80px; height: 80px; margin-bottom: 10px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        #score { font-size: 3.5rem; font-weight: bold; text-shadow: 0 0 20px rgba(241, 196, 15, 0.5); margin: 10px 0; }
        #tap-counter { font-size: 0.9rem; color: #f1c40f; margin-top: 5px; }
        #game-area { flex: 1; display: flex; align-items: center; justify-content: center; position: relative; }
        #face { width: 85vw; max-width: 400px; cursor: pointer; transition: transform 0.1s; user-select: none; }
        #face:active { transform: scale(0.92); }
        .tap-effect { position: absolute; color: #f1c40f; font-weight: bold; font-size: 1.5rem; pointer-events: none; animation: floatUp 1s ease-out forwards; }
        @keyframes floatUp { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
        .footer { padding: 20px 20px 30px 20px; display: flex; flex-direction: column; align-items: center; gap: 12px; background: rgba(0, 0, 0, 0.3); }
        #energy-label { font-size: 0.85rem; color: #bbb; margin-bottom: 5px; }
        #energy-container { width: 90%; max-width: 400px; background: #333; height: 14px; border-radius: 10px; overflow: hidden; border: 2px solid #444; }
        #energy-bar { width: 100%; height: 100%; background: linear-gradient(90deg, #f39c12 0%, #f1c40f 100%); transition: width 0.2s; }
        .btn { background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); color: white; border: none; padding: 16px 30px; border-radius: 30px; font-weight: bold; width: 90%; max-width: 400px; font-size: 1.1rem; cursor: pointer; }
        .btn:active { transform: scale(0.95); }
        .btn:disabled { opacity: 0.6; }
        #loading { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; display: flex; align-items: center; justify-content: center; z-index: 1000; font-size: 1.5rem; }
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="loading"><div>Loading...</div></div>
    <div id="header">
        <img src="coin.png" id="coin-icon">
        <div id="score">0</div>
        <div id="tap-counter">Total Taps: 0</div>
    </div>
    <div id="game-area"><img id="face" src="face.png"></div>
    <div class="footer">
        <div id="energy-label">Energy: <span id="e-val">100</span>/100</div>
        <div id="energy-container"><div id="energy-bar"></div></div>
        <button class="btn" id="sync-btn" onclick="syncAndRank()">ðŸ’¾ SYNC & RANK</button>
    </div>
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();
        let score = 0, tapPower = 1, energy = 100, totalTaps = 0, isLoading = true;
        
        tg.CloudStorage.getItems(['score', 'tapPower', 'totalTaps'], (err, values) => {
            if (!err && values) {
                score = parseInt(values.score) || 0;
                tapPower = parseInt(values.tapPower) || 1;
                totalTaps = parseInt(values.totalTaps) || 0;
            }
            updateUI(); isLoading = false;
            document.getElementById('loading').classList.add('hidden');
        });
        
        setTimeout(() => { if (isLoading) { isLoading = false; document.getElementById('loading').classList.add('hidden'); updateUI(); } }, 3000);
        
        function updateUI() {
            document.getElementById('score').innerText = score.toLocaleString();
            document.getElementById('e-val').innerText = Math.floor(energy);
            document.getElementById('energy-bar').style.width = energy + "%";
            document.getElementById('tap-counter').innerText = `Total Taps: ${totalTaps.toLocaleString()}`;
        }
        
        setInterval(() => { if (energy < 100) { energy = Math.min(100, energy + 1); updateUI(); } }, 1000);
        setInterval(() => { if (!isLoading) { tg.CloudStorage.setItem('score', String(score)); tg.CloudStorage.setItem('tapPower', String(tapPower)); tg.CloudStorage.setItem('totalTaps', String(totalTaps)); } }, 30000);
        
        document.getElementById('face').addEventListener('click', function(e) {
            if (energy >= 1) {
                score += tapPower; energy -= 1; totalTaps += 1;
                tg.HapticFeedback.impactOccurred('medium');
                const effect = document.createElement('div');
                effect.className = 'tap-effect';
                effect.innerText = `+${tapPower}`;
                effect.style.left = e.clientX + 'px';
                effect.style.top = e.clientY + 'px';
                document.getElementById('game-area').appendChild(effect);
                setTimeout(() => effect.remove(), 1000);
                updateUI();
            } else { tg.HapticFeedback.notificationOccurred('error'); }
        });
        
        function syncAndRank() {
            const btn = document.getElementById('sync-btn');
            if (isLoading || btn.disabled) return;
            btn.innerText = "ðŸš€ SENDING..."; btn.disabled = true;
            const dataToSend = JSON.stringify({ score: score, totalTaps: totalTaps });
            try {
                tg.sendData(dataToSend);
                setTimeout(() => tg.close(), 500);
            } catch (e) {
                tg.showAlert("Error: " + e.message);
                btn.innerText = "ðŸ’¾ SYNC & RANK"; btn.disabled = false;
            }
        }
    </script>
</body>
</html>
